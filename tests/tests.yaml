---
- config:
    - testset: "Puppenc tests"
    - variable_binds: {env_name: 'my_test_environment'}

- test:
    - group: "Start"
    - name: "Home api"
    - url: "/api/v1/"
    - expected_status: [200]
    - validators:
        - compare: {jsonpath_mini: "name", comparator: "eq", expected: 'Puppenc'}

- test:
    - group: "Environments"
    - name: "Check if my environment is not here"
    - url: "/api/v1/environments/1"
    - expected_status: [404]
    - validators:
        - compare: {jsonpath_mini: "success", comparator: "eq", expected: false}

- test:
    - group: "Environments"
    - name: "Create an environment"
    - url: "/api/v1/environments"
    - method: "POST"
    - body: '{"name": "$env_name"}'
    - headers: {'Content-Type': 'application/json'}
    - expected_status: [200]

- test:
    - group: "Environments"
    - name: "Check my env"
    - url: "/api/v1/environments/1"
    - expected_status: [200]
    - validators:
        - compare: {jsonpath_mini: "name", comparator: "eq", expected: "$env_name"}

- test:
    - group: "Environments"
    - name: "Delete my env"
    - url: "/api/v1/environments/1"
    - method: 'DELETE'
    - expected_status: [200]
    - validators:
        - compare: {jsonpath_mini: "success", comparator: "eq", expected: true}

- test:
    - group: "Environments"
    - name: "Check my env after delete"
    - url: "/api/v1/environments/1"
    - expected_status: [404]
    - validators:
        - compare: {jsonpath_mini: "success", comparator: "eq", expected: false} 
