
 #  ______ _   ___      _______ _____   ____  _   _ __  __ ______ _   _ _______ _____
 # |  ____| \ | \ \    / /_   _|  __ \ / __ \| \ | |  \/  |  ____| \ | |__   __/ ____|
 # | |__  |  \| |\ \  / /  | | | |__) | |  | |  \| | \  / | |__  |  \| |  | | | (___
 # |  __| | . ` | \ \/ /   | | |  _  /| |  | | . ` | |\/| |  __| | . ` |  | |  \___ \
 # | |____| |\  |  \  /   _| |_| | \ \| |__| | |\  | |  | | |____| |\  |  | |  ____) |
 # |______|_| \_|   \/   |_____|_|  \_\\____/|_| \_|_|  |_|______|_| \_|  |_| |_____/
 #

- test:
  - group: "Environments"
  - name: "Check if my environment is not here"
  - url: "/api/v1/environments/1"
  - expected_status: [404]
  - validators:
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: false}

- test:
  - group: "Environments"
  - name: "Create an environment"
  - url: "/api/v1/environments"
  - method: "POST"
  - body: '{"name": "my_test_environment"}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "id", comparator: "eq", expected: 1}
    - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_test_environment"}
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: true}

- test:
  - group: "Environments"
  - name: "Create the same environment"
  - url: "/api/v1/environments"
  - method: "POST"
  - body: '{"name": "my_test_environment"}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "message", comparator: "contains", expected: "already exists"}
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: false}

- test:
  - group: "Environments"
  - name: "Check my env"
  - url: "/api/v1/environments/1"
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "id", comparator: "eq", expected: 1}
    - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_test_environment"}
    - compare: {jsonpath_mini: "delete_date", comparator: "type", expected: "null"}
    - compare: {jsonpath_mini: "insert_date", comparator: "type", expected: "string"}
    - compare: {jsonpath_mini: "update_date", comparator: "type", expected: "null"}

- test:
  - group: "Environments"
  - name: "Edit an environment"
  - url: "/api/v1/environments/1"
  - method: "PUT"
  - body: '{"name": "my_new_env"}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: true}
    - compare: {jsonpath_mini: "message", comparator: "eq", expected: "Successfully modified"}

- test:
    - group: "Environments"
    - name: "Check my edited env"
    - url: "/api/v1/environments/1"
    - expected_status: [200]
    - validators:
        - compare: {jsonpath_mini: "id", comparator: "eq", expected: 1}
        - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_new_env"}
        - compare: {jsonpath_mini: "delete_date", comparator: "type", expected: "null"}
        - compare: {jsonpath_mini: "insert_date", comparator: "type", expected: "string"}
        - compare: {jsonpath_mini: "update_date", comparator: "type", expected: "string"}

- test:
    - group: "Environments"
    - name: "Delete my env"
    - url: "/api/v1/environments/1"
    - method: 'DELETE'
    - expected_status: [200]
    - validators:
      - compare: {jsonpath_mini: "success", comparator: "eq", expected: true}
      - compare: {jsonpath_mini: "message", comparator: "eq", expected: "<Environment 'my_new_env'> deleted"}

- test:
    - group: "Environments"
    - name: "Check my env after delete"
    - url: "/api/v1/environments/1"
    - expected_status: [404]
    - validators:
        - compare: {jsonpath_mini: "success", comparator: "eq", expected: false}

- test:
  - group: "Environments"
  - name: "Create an environment"
  - url: "/api/v1/environments"
  - method: "POST"
  - body: '{"name": "my_new_env"}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "id", comparator: "eq", expected: 2}
    - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_new_env"}
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: true}

- test:
  - group: "Environments"
  - name: "Check my final env"
  - url: "/api/v1/environments/2"
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "id", comparator: "eq", expected: 2}
    - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_new_env"}
    - compare: {jsonpath_mini: "delete_date", comparator: "type", expected: "null"}
    - compare: {jsonpath_mini: "insert_date", comparator: "type", expected: "string"}
    - compare: {jsonpath_mini: "update_date", comparator: "type", expected: "null"}
