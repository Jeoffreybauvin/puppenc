 # __      __     _____  _____          ____  _      ______  _____
 # \ \    / /\   |  __ \|_   _|   /\   |  _ \| |    |  ____|/ ____|
 #  \ \  / /  \  | |__) | | |    /  \  | |_) | |    | |__  | (___
 #   \ \/ / /\ \ |  _  /  | |   / /\ \ |  _ <| |    |  __|  \___ \
 #    \  / ____ \| | \ \ _| |_ / ____ \| |_) | |____| |____ ____) |
 #     \/_/    \_\_|  \_\_____/_/    \_\____/|______|______|_____/
 #

- test:
  - group: "Variables"
  - name: "Check if my variable is not here"
  - url: "/api/v1/variables/1"
  - expected_status: [404]
  - validators:
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: false}

- test:
  - group: "Variables"
  - name: "Create a variable without content"
  - url: "/api/v1/variables"
  - method: "POST"
  - body: '{"name": "my_variable" }'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "id", comparator: "eq", expected: 1}
    - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_variable"}
    - compare: {jsonpath_mini: "content", comparator: "type", expected: "null"}
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: true}

- test:
  - group: "Variables"
  - name: "Create a variable with content"
  - url: "/api/v1/variables"
  - method: "POST"
  - body: '{"name": "my_variable_with_content", "content": "content_variable" }'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "id", comparator: "eq", expected: 2}
    - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_variable_with_content"}
    - compare: {jsonpath_mini: "content", comparator: "eq", expected: "content_variable"}
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: true}

- test:
  - group: "Variables"
  - name: "Create the same variable with content"
  - url: "/api/v1/variables"
  - method: "POST"
  - body: '{"name": "my_variable_with_content", "content": "content_variable" }'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [500]
  - validators:
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: false}
    - compare: {jsonpath_mini: "message", comparator: "eq", expected: "Something went wrong when trying to insert my_variable_with_content"}

- test:
  - group: "Variables"
  - name: "Check my variable without content"
  - url: "/api/v1/variables/1"
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "id", comparator: "eq", expected: 1}
    - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_variable"}
    - compare: {jsonpath_mini: "content", comparator: "type", expected: "null"}
    - compare: {jsonpath_mini: "insert_date", comparator: "type", expected: "string"}

- test:
  - group: "Variables"
  - name: "Check my variable without content"
  - url: "/api/v1/variables/2"
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "id", comparator: "eq", expected: 2}
    - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_variable_with_content"}
    - compare: {jsonpath_mini: "content", comparator: "eq", expected: "content_variable"}
    - compare: {jsonpath_mini: "insert_date", comparator: "type", expected: "string"}

- test:
  - group: "Variables"
  - name: "Edit a variable without content"
  - url: "/api/v1/variables/1"
  - method: "PUT"
  - body: '{"name": "my_new_variable"}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: true}
    - compare: {jsonpath_mini: "message", comparator: "eq", expected: "Successfully modified"}

- test:
    - group: "Variables"
    - name: "Check my edited variable without content"
    - url: "/api/v1/variables/1"
    - expected_status: [200]
    - validators:
        - compare: {jsonpath_mini: "id", comparator: "eq", expected: 1}
        - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_new_variable"}
        - compare: {jsonpath_mini: "content", comparator: "type", expected: "null"}
        - compare: {jsonpath_mini: "delete_date", comparator: "type", expected: "null"}
        - compare: {jsonpath_mini: "insert_date", comparator: "type", expected: "string"}
        - compare: {jsonpath_mini: "update_date", comparator: "type", expected: "string"}

- test:
  - group: "Variables"
  - name: "Edit a variable wit content"
  - url: "/api/v1/variables/2"
  - method: "PUT"
  - body: '{"name": "my_new_variable_with_content", "content": "new_content"}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: true}
    - compare: {jsonpath_mini: "message", comparator: "eq", expected: "Successfully modified"}

- test:
    - group: "Variables"
    - name: "Check my edited variable with content"
    - url: "/api/v1/variables/2"
    - expected_status: [200]
    - validators:
        - compare: {jsonpath_mini: "id", comparator: "eq", expected: 2}
        - compare: {jsonpath_mini: "name", comparator: "eq", expected: "my_new_variable_with_content"}
        - compare: {jsonpath_mini: "content", comparator: "eq", expected: "new_content"}
        - compare: {jsonpath_mini: "delete_date", comparator: "type", expected: "null"}
        - compare: {jsonpath_mini: "insert_date", comparator: "type", expected: "string"}
        - compare: {jsonpath_mini: "update_date", comparator: "type", expected: "string"}


- test:
  - group: "Variables"
  - name: "Delete my variable"
  - url: "/api/v1/variables/1"
  - method: 'DELETE'
  - expected_status: [200]
  - validators:
    - compare: {jsonpath_mini: "success", comparator: "eq", expected: true}
    - compare: {jsonpath_mini: "message", comparator: "eq", expected: "<Variable 'my_new_variable'> deleted"}


- test:
    - group: "Variables"
    - name: "Check my variable after delete"
    - url: "/api/v1/variables/1"
    - expected_status: [404]
    - validators:
        - compare: {jsonpath_mini: "success", comparator: "eq", expected: false}

- test:
    - group: "Variables"
    - name: "Check my deleted variable without content"
    - url: "/api/v1/variables/1"
    - expected_status: [404]
    - validators:
        - compare: {jsonpath_mini: "success", comparator: "eq", expected: false}
